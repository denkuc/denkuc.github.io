function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var t=globalThis.parcelRequire80e1,r=t.register;r("aIpib",function(r,i){e(r.exports,"WebGPURenderer",()=>w);var s=t("i9BKe"),o=t("jP4ql"),n=t("lAo8F"),a=t("kKrFV"),u=t("3UUq4"),l=t("4deGe"),d=t("2bK9z"),h=t("gvoJG"),c=t("jjlQn"),p=t("cDDt3"),f=t("48A5x"),g=t("jMzA5"),m=t("cviv9"),_=t("dcnMW"),x=t("4J4tb"),b=t("9I99c"),y=t("7HeXo"),G=t("9klnd"),S=t("3wUWA"),B=t("iNl6W");let P=[...l.SharedSystems,_.GpuUboSystem,g.GpuEncoderSystem,f.GpuDeviceSystem,c.GpuBufferSystem,B.GpuTextureSystem,y.GpuRenderTargetSystem,G.GpuShaderSystem,S.GpuStateSystem,b.PipelineSystem,p.GpuColorMaskSystem,m.GpuStencilSystem,h.BindGroupSystem],T=[...l.SharedRenderPipes,x.GpuUniformBatchPipe],v=[a.GpuBatchAdaptor,n.GpuMeshAdapter,o.GpuGraphicsAdaptor],C=[],M=[],U=[];(0,s.extensions).handleByNamedList(s.ExtensionType.WebGPUSystem,C),(0,s.extensions).handleByNamedList(s.ExtensionType.WebGPUPipes,M),(0,s.extensions).handleByNamedList(s.ExtensionType.WebGPUPipesAdaptor,U),(0,s.extensions).add(...P,...T,...v);class w extends u.AbstractRenderer{constructor(){super({name:"webgpu",type:d.RendererType.WEBGPU,systems:C,renderPipes:M,renderPipeAdaptors:U})}}}),r("jP4ql",function(r,i){e(r.exports,"GpuGraphicsAdaptor",()=>g);var s=t("i9BKe"),o=t("eY4rt"),n=t("1EHMq"),a=t("beJMG"),u=t("3JBHn"),l=t("cNnNT"),d=t("ikSZA"),h=t("huPGn"),c=t("kSpdC"),p=t("5iDyo"),f=t("cryyq");class g{init(){let e=new f.UniformGroup({uTransformMatrix:{value:new o.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),t=(0,u.compileHighShaderGpuProgram)({name:"graphics",bits:[l.colorBit,(0,d.generateTextureBatchBit)((0,n.getMaxTexturesPerBatch)()),h.localUniformBitGroup2,c.roundPixelsBit]});this.shader=new p.Shader({gpuProgram:t,resources:{localUniforms:e}})}execute(e,t){let r=t.context,i=r.customShader||this.shader,s=e.renderer,{batcher:o,instructions:n}=s.graphicsContext.getContextRenderData(r),u=s.encoder;u.setPipelineFromGeometryProgramAndState(o.geometry,i.gpuProgram,e.state),u.setGeometry(o.geometry,i.gpuProgram);let l=s.globalUniforms.bindGroup;u.setBindGroup(0,l,i.gpuProgram);let d=s.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);u.setBindGroup(2,d,i.gpuProgram);let h=n.instructions;for(let e=0;e<n.instructionSize;e++){let t=h[e];if(i.groups[1]=t.bindGroup,!t.gpuBindGroup){let e=t.textures;t.bindGroup=(0,a.getTextureBatchBindGroup)(e.textures,e.count),t.gpuBindGroup=s.bindGroup.getBindGroup(t.bindGroup,i.gpuProgram,1)}u.setBindGroup(1,t.bindGroup,i.gpuProgram),u.renderPassEncoder.drawIndexed(t.size,1,t.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}g.extension={type:[s.ExtensionType.WebGPUPipesAdaptor],name:"graphics"}}),r("huPGn",function(t,r){e(t.exports,"localUniformBit",()=>i),e(t.exports,"localUniformBitGroup2",()=>s),e(t.exports,"localUniformBitGl",()=>o);let i={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}},s={...i,vertex:{...i.vertex,header:i.vertex.header.replace("group(1)","group(2)")}},o={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}}}),r("lAo8F",function(r,i){e(r.exports,"GpuMeshAdapter",()=>p);var s=t("i9BKe"),o=t("eY4rt"),n=t("3JBHn"),a=t("huPGn"),u=t("kSpdC"),l=t("kGDJh"),d=t("5iDyo"),h=t("bLlTJ"),c=t("hUCK4");class p{init(){let e=(0,n.compileHighShaderGpuProgram)({name:"mesh",bits:[a.localUniformBit,l.textureBit,u.roundPixelsBit]});this._shader=new d.Shader({gpuProgram:e,resources:{uTexture:h.Texture.EMPTY._source,uSampler:h.Texture.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new o.Matrix}}}})}execute(e,t){let r=e.renderer,i=t._shader;if(i){if(!i.gpuProgram){(0,c.warn)("Mesh shader has no gpuProgram",t.shader);return}}else(i=this._shader).groups[2]=r.texture.getTextureBindGroup(t.texture);let s=i.gpuProgram;if(s.autoAssignGlobalUniforms&&(i.groups[0]=r.globalUniforms.bindGroup),s.autoAssignLocalUniforms){let t=e.localUniforms;i.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(t,!0)}r.encoder.draw({geometry:t._geometry,shader:i,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}p.extension={type:[s.ExtensionType.WebGPUPipesAdaptor],name:"mesh"}}),r("kKrFV",function(r,i){e(r.exports,"GpuBatchAdaptor",()=>u);var s=t("i9BKe"),o=t("2Aebl"),n=t("beJMG");let a=(0,o.State).for2d();class u{start(e,t,r){let i=e.renderer,s=i.encoder,o=r.gpuProgram;this._shader=r,this._geometry=t,s.setGeometry(t,o),a.blendMode="normal",i.pipeline.getPipeline(t,o,a);let n=i.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,n,o)}execute(e,t){let r=this._shader.gpuProgram,i=e.renderer,s=i.encoder;if(!t.bindGroup){let e=t.textures;t.bindGroup=(0,n.getTextureBatchBindGroup)(e.textures,e.count)}a.blendMode=t.blendMode;let o=i.bindGroup.getBindGroup(t.bindGroup,r,1),u=i.pipeline.getPipeline(this._geometry,r,a);t.bindGroup._touch(i.textureGC.count),s.setPipeline(u),s.renderPassEncoder.setBindGroup(1,o),s.renderPassEncoder.drawIndexed(t.size,1,t.start)}}u.extension={type:[s.ExtensionType.WebGPUPipesAdaptor],name:"batch"}}),r("2Aebl",function(t,r){e(t.exports,"State",()=>o);let i={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},s=class e{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}set cullMode(e){if("none"===e){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace="front"===e}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend="none"!==e,this._blendMode=e,this._blendModeId=i[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let t=new e;return t.depthTest=!1,t.blend=!0,t}};s.default2d=s.for2d();let o=s}),r("gvoJG",function(r,i){e(r.exports,"BindGroupSystem",()=>o);var s=t("i9BKe");class o{constructor(e){this._hash=/* @__PURE__ */Object.create(null),this._renderer=e}contextChange(e){this._gpu=e}getBindGroup(e,t,r){return e._updateKey(),this._hash[e._key]||this._createBindGroup(e,t,r)}_createBindGroup(e,t,r){let i=this._gpu.device,s=t.layout[r],o=[],n=this._renderer;for(let t in s){let r;let i=e.resources[t]??e.resources[s[t]];if("uniformGroup"===i._resourceType){n.ubo.updateUniformGroup(i);let e=i.buffer;r={buffer:n.buffer.getGPUBuffer(e),offset:0,size:e.descriptor.size}}else"buffer"===i._resourceType?r={buffer:n.buffer.getGPUBuffer(i),offset:0,size:i.descriptor.size}:"bufferResource"===i._resourceType?r={buffer:n.buffer.getGPUBuffer(i.buffer),offset:i.offset,size:i.size}:"textureSampler"===i._resourceType?r=n.texture.getGpuSampler(i):"textureSource"===i._resourceType&&(r=n.texture.getGpuSource(i).createView({}));o.push({binding:s[t],resource:r})}let a=n.shader.getProgramData(t).bindGroups[r],u=i.createBindGroup({layout:a,entries:o});return this._hash[e._key]=u,u}destroy(){for(let e of Object.keys(this._hash))this._hash[e]=null;this._hash=null,this._renderer=null}}o.extension={type:[s.ExtensionType.WebGPUSystem],name:"bindGroup"}}),r("jjlQn",function(r,i){e(r.exports,"GpuBufferSystem",()=>n);var s=t("i9BKe"),o=t("1tfR4");class n{constructor(){this._gpuBuffers=/* @__PURE__ */Object.create(null),this._managedBuffers=[]}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){let t=this._gpuBuffers[e.uid]||this.createGPUBuffer(e),r=e.data;return e._updateID&&r&&(e._updateID=0,this._gpu.device.queue.writeBuffer(t,0,r.buffer,0,(e._updateSize||r.byteLength)+3&-4)),t}destroyAll(){for(let e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){this._gpuBuffers[e.uid]||(e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(e));let t=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&((0,o.fastCopy)(e.data.buffer,t.getMappedRange()),t.unmap()),this._gpuBuffers[e.uid]=t,t}onBufferChange(e){this._gpuBuffers[e.uid].destroy(),e._updateID=0,this._gpuBuffers[e.uid]=this.createGPUBuffer(e)}onBufferDestroy(e){this._managedBuffers.splice(this._managedBuffers.indexOf(e),1),this._destroyBuffer(e)}destroy(){this._managedBuffers.forEach(e=>this._destroyBuffer(e)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(e){this._gpuBuffers[e.uid].destroy(),e.off("update",this.updateBuffer,this),e.off("change",this.onBufferChange,this),e.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[e.uid]=null}}n.extension={type:[s.ExtensionType.WebGPUSystem],name:"buffer"}}),r("cDDt3",function(r,i){e(r.exports,"GpuColorMaskSystem",()=>o);var s=t("i9BKe");class o{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){this._renderer=null,this._colorMaskCache=null}}o.extension={type:[s.ExtensionType.WebGPUSystem],name:"colorMask"}}),r("48A5x",function(r,i){e(r.exports,"GpuDeviceSystem",()=>n);var s=t("iCGeI"),o=t("i9BKe");class n{constructor(e){this._renderer=e}async init(e){return this._initPromise||(this._initPromise=this._createDeviceAndAdaptor(e).then(e=>{this.gpu=e,this._renderer.runners.contextChange.emit(this.gpu)})),this._initPromise}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){let t=await (0,s.DOMAdapter).get().getNavigator().gpu.requestAdapter({powerPreference:e.powerPreference,forceFallbackAdapter:e.forceFallbackAdapter}),r=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(e=>t.features.has(e)),i=await t.requestDevice({requiredFeatures:r});return{adapter:t,device:i}}destroy(){this.gpu=null,this._renderer=null}}n.extension={type:[o.ExtensionType.WebGPUSystem],name:"device"},n.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1}}),r("jMzA5",function(r,i){e(r.exports,"GpuEncoderSystem",()=>o);var s=t("i9BKe");class o{constructor(e){this._boundBindGroup=/* @__PURE__ */Object.create(null),this._boundVertexBuffer=/* @__PURE__ */Object.create(null),this._renderer=e}renderStart(){this.commandFinished=new Promise(e=>{this._resolveCommandFinished=e}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,t,r,i){let s=this._renderer.pipeline.getPipeline(e,t,r,i);this.setPipeline(s)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,t){this._boundVertexBuffer[e]!==t&&(this._boundVertexBuffer[e]=t,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(t)))}_setIndexBuffer(e){if(this._boundIndexBuffer===e)return;this._boundIndexBuffer=e;let t=2===e.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),t)}resetBindGroup(e){this._boundBindGroup[e]=null}setBindGroup(e,t,r){if(this._boundBindGroup[e]===t)return;this._boundBindGroup[e]=t,t._touch(this._renderer.textureGC.count);let i=this._renderer.bindGroup.getBindGroup(t,r,e);this.renderPassEncoder.setBindGroup(e,i)}setGeometry(e,t){let r=this._renderer.pipeline.getBufferNamesToBind(e,t);for(let t in r)this._setVertexBuffer(t,e.attributes[r[t]].buffer);e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,t){for(let r in e.groups){let i=e.groups[r];t||this._syncBindGroup(i),this.setBindGroup(r,i,e.gpuProgram)}}_syncBindGroup(e){for(let t in e.resources){let r=e.resources[t];r.isUniformGroup&&this._renderer.ubo.updateUniformGroup(r)}}draw(e){let{geometry:t,shader:r,state:i,topology:s,size:o,start:n,instanceCount:a,skipSync:u}=e;this.setPipelineFromGeometryProgramAndState(t,r.gpuProgram,i,s),this.setGeometry(t,r.gpuProgram),this._setShaderBindGroups(r,u),t.indexBuffer?this.renderPassEncoder.drawIndexed(o||t.indexBuffer.data.length,a||t.instanceCount,n||0):this.renderPassEncoder.draw(o||t.getSize(),a||t.instanceCount,n||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){let e=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);let t=this._boundPipeline,r={...this._boundVertexBuffer},i=this._boundIndexBuffer,s={...this._boundBindGroup};this._clearCache();let o=this._renderer.renderTarget.viewport;for(let e in this.renderPassEncoder.setViewport(o.x,o.y,o.width,o.height,0,1),this.setPipeline(t),r)this._setVertexBuffer(e,r[e]);for(let e in s)this.setBindGroup(e,s[e],null);this._setIndexBuffer(i)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}}o.extension={type:[s.ExtensionType.WebGPUSystem],name:"encoder",priority:1}}),r("cviv9",function(r,i){e(r.exports,"GpuStencilSystem",()=>n);var s=t("i9BKe"),o=t("eE5Ke");class n{constructor(e){this._renderTargetStencilState=/* @__PURE__ */Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:o.STENCIL_MODES.DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){let r=this._renderTargetStencilState[this._activeRenderTarget.uid];r.stencilMode=e,r.stencilReference=t;let i=this._renderer;i.pipeline.setStencilMode(e),i.encoder.renderPassEncoder.setStencilReference(t)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}n.extension={type:[s.ExtensionType.WebGPUSystem],name:"stencil"}}),r("dcnMW",function(r,i){e(r.exports,"GpuUboSystem",()=>u);var s=t("i9BKe"),o=t("gl2WV"),n=t("2zv18"),a=t("caF60");class u extends o.UboSystem{constructor(){super({createUboElements:n.createUboElementsWGSL,generateUboSync:a.createUboSyncFunctionWGSL})}}u.extension={type:[s.ExtensionType.WebGPUSystem],name:"ubo"}}),r("2zv18",function(t,r){e(t.exports,"WGSL_ALIGN_SIZE_DATA",()=>i),e(t.exports,"createUboElementsWGSL",()=>s);let i={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function s(e){let t=e.map(e=>({data:e,offset:0,size:0})),r=0;for(let e=0;e<t.length;e++){let s=t[e],o=i[s.data.type].size,n=i[s.data.type].align;if(!i[s.data.type])throw Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${s.data.type}`);s.data.size>1&&(o=Math.max(o,n)*s.data.size),r=Math.ceil(r/n)*n,s.size=o,s.offset=r,r+=o}return{uboElements:t,size:r=16*Math.ceil(r/16)}}}),r("caF60",function(r,i){e(r.exports,"createUboSyncFunctionWGSL",()=>a);var s=t("5NNJl"),o=t("1nMtt"),n=t("74gRR");function a(e){return(0,s.createUboSyncFunction)(e,"uboWgsl",n.generateArraySyncWGSL,o.uboSyncFunctionsWGSL)}}),r("74gRR",function(r,i){e(r.exports,"generateArraySyncWGSL",()=>o);var s=t("2zv18");function o(e,t){let{size:r,align:i}=s.WGSL_ALIGN_SIZE_DATA[e.data.type],o=(i-r)/4;return`
         v = uv.${e.data.name};
         ${0!==t?`offset += ${t};`:""}

         arrayOffset = offset;

         t = 0;

         for(var i=0; i < ${e.data.size*(r/4)}; i++)
         {
             for(var j = 0; j < ${r/4}; j++)
             {
                 data[arrayOffset++] = v[t++];
             }
             ${0!==o?`arrayOffset += ${o};`:""}
         }
     `}}),r("4J4tb",function(r,i){e(r.exports,"GpuUniformBatchPipe",()=>d);var s=t("i9BKe"),o=t("lvEAL"),n=t("1bR8i"),a=t("1UZ6r"),u=t("8XfnW"),l=t("awcfo");class d{constructor(e){this._bindGroupHash=/* @__PURE__ */Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._batchBuffer=new u.UboBatch({minUniformOffsetAlignment:128});for(let e=0;e<2;e++){let t=a.BufferUsage.UNIFORM|a.BufferUsage.COPY_DST;0===e&&(t|=a.BufferUsage.COPY_SRC),this._buffers.push(new o.Buffer({data:this._batchBuffer.data,usage:t}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(let e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,t){if(!t&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.ubo.ensureUniformGroup(e);let r=e.buffer.data,i=this._batchBuffer.addEmptyGroup(r.length);return this._renderer.ubo.syncUniformGroup(e,this._batchBuffer.data,i/4),this._bindGroupHash[e.uid]=this._getBindGroup(i/128),this._bindGroupHash[e.uid]}getUboResource(e){this._renderer.ubo.updateUniformGroup(e);let t=e.buffer.data,r=this._batchBuffer.addGroup(t);return this._getBufferResource(r/128)}getArrayBindGroup(e){let t=this._batchBuffer.addGroup(e);return this._getBindGroup(t/128)}getArrayBufferResource(e){let t=this._batchBuffer.addGroup(e);return this._getBufferResource(t/128)}_getBufferResource(e){if(!this._bufferResources[e]){let t=this._buffers[e%2];this._bufferResources[e]=new n.BufferResource({buffer:t,offset:(e/2|0)*256,size:128})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){let t=new l.BindGroup({0:this._getBufferResource(e)});this._bindGroups[e]=t}return this._bindGroups[e]}_uploadBindGroups(){let e=this._renderer.buffer,t=this._buffers[0];t.update(this._batchBuffer.byteIndex),e.updateBuffer(t);let r=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){let s=this._buffers[i];r.copyBufferToBuffer(e.getGPUBuffer(t),128,e.getGPUBuffer(s),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([r.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}d.extension={type:[s.ExtensionType.WebGPUPipes],name:"uniformBatch"}}),r("8XfnW",function(t,r){e(t.exports,"UboBatch",()=>i);class i{constructor({minUniformOffsetAlignment:e}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=e,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw Error(`UniformBufferBatch: array is too large: ${4*e}`);let t=this.byteIndex,r=t+4*e;if((r=Math.ceil(r/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment)>4*this.data.length)throw Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=r,t}addGroup(e){let t=this.addEmptyGroup(e.length);for(let r=0;r<e.length;r++)this.data[t/4+r]=e[r];return t}destroy(){this._buffer.destroy(),this._buffer=null,this.data=null}}}),r("9I99c",function(r,i){e(r.exports,"PipelineSystem",()=>h);var s=t("i9BKe"),o=t("hUCK4"),n=t("4EpFm"),a=t("eE5Ke"),u=t("9kWs1"),l=t("gmJT6");let d={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};class h{constructor(e){this._moduleCache=/* @__PURE__ */Object.create(null),this._bufferLayoutsCache=/* @__PURE__ */Object.create(null),this._bindingNamesCache=/* @__PURE__ */Object.create(null),this._pipeCache=/* @__PURE__ */Object.create(null),this._pipeStateCaches=/* @__PURE__ */Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(a.STENCIL_MODES.DISABLED),this._updatePipeHash()}setMultisampleCount(e){this._multisampleCount!==e&&(this._multisampleCount=e,this._updatePipeHash())}setRenderTarget(e){this._multisampleCount=e.msaaSamples,this._depthStencilAttachment=e.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(e){this._colorMask!==e&&(this._colorMask=e,this._updatePipeHash())}setStencilMode(e){this._stencilMode!==e&&(this._stencilMode=e,this._stencilState=l.GpuStencilModesToPixi[e],this._updatePipeHash())}setPipeline(e,t,r,i){let s=this.getPipeline(e,t,r);i.setPipeline(s)}getPipeline(e,t,r,i){var s,o;e._layoutKey||((0,n.ensureAttributes)(e,t.attributeData),this._generateBufferKey(e)),i=i||e.topology;let a=(s=e._layoutKey,o=t._layoutKey,s<<24|o<<16|r.data<<10|r._blendModeId<<5|d[i]);return this._pipeCache[a]||(this._pipeCache[a]=this._createPipeline(e,t,r,i)),this._pipeCache[a]}_createPipeline(e,t,r,i){let s=this._gpu.device,o=this._createVertexBufferLayouts(e,t),n=this._renderer.state.getColorTargets(r);n[0].writeMask=this._stencilMode===a.STENCIL_MODES.RENDERING_MASK_ADD?0:this._colorMask;let u=this._renderer.shader.getProgramData(t).pipeline,l={vertex:{module:this._getModule(t.vertex.source),entryPoint:t.vertex.entryPoint,buffers:o},fragment:{module:this._getModule(t.fragment.source),entryPoint:t.fragment.entryPoint,targets:n},primitive:{topology:i,cullMode:r.cullMode},layout:u,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};return this._depthStencilAttachment&&(l.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r.depthTest?"less":"always"}),s.createRenderPipeline(l)}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){let t=this._gpu.device;return this._moduleCache[e]=t.createShaderModule({code:e}),this._moduleCache[e]}_generateBufferKey(e){let t=[],r=0,i=Object.keys(e.attributes).sort();for(let s=0;s<i.length;s++){let o=e.attributes[i[s]];t[r++]=o.offset,t[r++]=o.format,t[r++]=o.stride,t[r++]=o.instance}let s=t.join("|");return e._layoutKey=(0,u.createIdFromString)(s,"geometry"),e._layoutKey}_generateAttributeLocationsKey(e){let t=[],r=0,i=Object.keys(e.attributeData).sort();for(let s=0;s<i.length;s++){let o=e.attributeData[i[s]];t[r++]=o.location}let s=t.join("|");return e._attributeLocationsKey=(0,u.createIdFromString)(s,"programAttributes"),e._attributeLocationsKey}getBufferNamesToBind(e,t){let r=e._layoutKey<<16|t._attributeLocationsKey;if(this._bindingNamesCache[r])return this._bindingNamesCache[r];let i=this._createVertexBufferLayouts(e,t),s=/* @__PURE__ */Object.create(null),o=t.attributeData;for(let e=0;e<i.length;e++)for(let t in o)if(o[t].location===e){s[e]=t;break}return this._bindingNamesCache[r]=s,s}_createVertexBufferLayouts(e,t){t._attributeLocationsKey||this._generateAttributeLocationsKey(t);let r=e._layoutKey<<16|t._attributeLocationsKey;if(this._bufferLayoutsCache[r])return this._bufferLayoutsCache[r];let i=[];return e.buffers.forEach(r=>{let s={arrayStride:0,stepMode:"vertex",attributes:[]},n=s.attributes;for(let i in t.attributeData){let a=e.attributes[i];(a.divisor??1)!==1&&(0,o.warn)(`Attribute ${i} has an invalid divisor value of '${a.divisor}'. WebGPU only supports a divisor value of 1`),a.buffer===r&&(s.arrayStride=a.stride,s.stepMode=a.instance?"instance":"vertex",n.push({shaderLocation:t.attributeData[i].location,offset:a.offset,format:a.format}))}n.length&&i.push(s)}),this._bufferLayoutsCache[r]=i,i}_updatePipeHash(){var e,t;let r=(e=this._stencilMode,t=this._multisampleCount,this._colorMask<<6|e<<3|this._depthStencilAttachment<<1|t);this._pipeStateCaches[r]||(this._pipeStateCaches[r]=/* @__PURE__ */Object.create(null)),this._pipeCache=this._pipeStateCaches[r]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}h.extension={type:[s.ExtensionType.WebGPUSystem],name:"pipeline"}}),r("7HeXo",function(r,i){e(r.exports,"GpuRenderTargetSystem",()=>a);var s=t("i9BKe"),o=t("bFvcQ"),n=t("lWy7K");class a extends o.RenderTargetSystem{constructor(e){super(e),this.adaptor=new n.GpuRenderTargetAdaptor,this.adaptor.init(e,this)}}a.extension={type:[s.ExtensionType.WebGPUSystem],name:"renderTarget"}}),r("lWy7K",function(r,i){e(r.exports,"GpuRenderTargetAdaptor",()=>u);var s=t("hFYOq"),o=t("8xl7d"),n=t("iA5fe"),a=t("jjlc1");class u{init(e,t){this._renderer=e,this._renderTargetSystem=t}copyToTexture(e,t,r,i,s){let o=this._renderer,n=this._getGpuColorTexture(e),a=o.texture.getGpuSource(t.source);return o.encoder.commandEncoder.copyTextureToTexture({texture:n,origin:r},{texture:a,origin:s},i),t}startRenderPass(e,t=!0,r,i){let s=this._renderTargetSystem.getGpuRenderTarget(e),o=this.getDescriptor(e,t,r);s.descriptor=o,this._renderer.pipeline.setRenderTarget(s),this._renderer.encoder.beginRenderPass(s),this._renderer.encoder.setViewport(i)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);return t.contexts[0]?t.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,t,r){let i;"boolean"==typeof t&&(t=t?s.CLEAR.ALL:s.CLEAR.NONE);let o=this._renderTargetSystem,n=o.getGpuRenderTarget(e),a=e.colorTextures.map((e,i)=>{let a,u;let l=n.contexts[i];a=l?l.getCurrentTexture().createView():this._renderer.texture.getGpuSource(e).createView({mipLevelCount:1}),n.msaaTextures[i]&&(u=a,a=this._renderer.texture.getTextureView(n.msaaTextures[i]));let d=t&s.CLEAR.COLOR?"clear":"load";return r??(r=o.defaultClearColor),{view:a,resolveTarget:u,clearValue:r,storeOp:"store",loadOp:d}});if((e.stencil||e.depth)&&!e.depthStencilTexture&&(e.ensureDepthStencilTexture(),e.depthStencilTexture.source.sampleCount=n.msaa?4:1),e.depthStencilTexture){let r=t&s.CLEAR.STENCIL?"clear":"load",o=t&s.CLEAR.DEPTH?"clear":"load";i={view:this._renderer.texture.getGpuSource(e.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:r,depthClearValue:1,depthLoadOp:o,depthStoreOp:"store"}}return{colorAttachments:a,depthStencilAttachment:i}}clear(e,t=!0,r,i){if(!t)return;let{gpu:s,encoder:o}=this._renderer,n=s.device;if(null===o.commandEncoder){let s=n.createCommandEncoder(),o=this.getDescriptor(e,t,r),a=s.beginRenderPass(o);a.setViewport(i.x,i.y,i.width,i.height,0,1),a.end();let u=s.finish();n.queue.submit([u])}else this.startRenderPass(e,t,r,i)}initGpuRenderTarget(e){e.isRoot=!0;let t=new a.GpuRenderTarget;return e.colorTextures.forEach((e,r)=>{if((0,o.CanvasSource).test(e.resource)){let i=e.resource.getContext("webgpu"),s=e.transparent?"premultiplied":"opaque";try{i.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:s})}catch(e){console.error(e)}t.contexts[r]=i}if(t.msaa=e.source.antialias,e.source.antialias){let e=new n.TextureSource({width:0,height:0,sampleCount:4});t.msaaTextures[r]=e}}),t.msaa&&(t.msaaSamples=4,e.depthStencilTexture&&(e.depthStencilTexture.source.sampleCount=4)),t}destroyGpuRenderTarget(e){e.contexts.forEach(e=>{e.unconfigure()}),e.msaaTextures.forEach(e=>{e.destroy()}),e.msaaTextures.length=0,e.contexts.length=0}ensureDepthStencilTexture(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);e.depthStencilTexture&&t.msaa&&(e.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);t.width=e.width,t.height=e.height,t.msaa&&e.colorTextures.forEach((e,r)=>{let i=t.msaaTextures[r];i?.resize(e.source.width,e.source.height,e.source._resolution)})}}}),r("jjlc1",function(t,r){e(t.exports,"GpuRenderTarget",()=>i);class i{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}}),r("9klnd",function(r,i){e(r.exports,"GpuShaderSystem",()=>o);var s=t("i9BKe");class o{constructor(){this._gpuProgramData=/* @__PURE__ */Object.create(null)}contextChange(e){this._gpu=e,this.maxTextures=e.device.limits.maxSampledTexturesPerShaderStage}getProgramData(e){return this._gpuProgramData[e._layoutKey]||this._createGPUProgramData(e)}_createGPUProgramData(e){let t=this._gpu.device,r=e.gpuLayout.map(e=>t.createBindGroupLayout({entries:e}));return this._gpuProgramData[e._layoutKey]={bindGroups:r,pipeline:t.createPipelineLayout({bindGroupLayouts:r})},this._gpuProgramData[e._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}o.extension={type:[s.ExtensionType.WebGPUSystem],name:"shader"}}),r("3wUWA",function(r,i){e(r.exports,"GpuStateSystem",()=>a);var s=t("i9BKe"),o=t("2Aebl"),n=t("4a9of");class a{constructor(){this.defaultState=new o.State,this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){return[{format:"bgra8unorm",writeMask:0,blend:n.GpuBlendModesToPixi[e.blendMode]||n.GpuBlendModesToPixi.normal}]}destroy(){this.gpu=null}}a.extension={type:[s.ExtensionType.WebGPUSystem],name:"state"}}),r("4a9of",function(t,r){e(t.exports,"GpuBlendModesToPixi",()=>i);let i={};i.normal={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},i.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},i.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},i.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},i.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},i.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},i["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},i["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},i["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},i.erase={alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}},i.min={alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}},i.max={alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}}),r("iNl6W",function(r,i){e(r.exports,"GpuTextureSystem",()=>f);var s=t("iCGeI"),o=t("i9BKe"),n=t("cryyq"),a=t("6RGCN"),u=t("awcfo"),l=t("f2X4l"),d=t("BIhHc"),h=t("fK0Rx"),c=t("jGr2y"),p=t("h3MwH");class f{constructor(e){this.managedTextures=[],this._gpuSources=/* @__PURE__ */Object.create(null),this._gpuSamplers=/* @__PURE__ */Object.create(null),this._bindGroupHash=/* @__PURE__ */Object.create(null),this._textureViewHash=/* @__PURE__ */Object.create(null),this._uploads={image:h.gpuUploadImageResource,buffer:l.gpuUploadBufferImageResource,video:c.gpuUploadVideoResource,compressed:d.gpuUploadCompressedTextureResource},this._renderer=e}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){let t=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(t))+1}let t=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==e.uploadMethodId&&(t|=GPUTextureUsage.RENDER_ATTACHMENT,t|=GPUTextureUsage.COPY_SRC);let r=d.blockDataMap[e.format]||{blockBytes:4,blockWidth:1,blockHeight:1},i=Math.ceil(e.pixelWidth/r.blockWidth)*r.blockWidth,s=Math.ceil(e.pixelHeight/r.blockHeight)*r.blockHeight,o={label:e.label,size:{width:i,height:s},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:t},n=this._gpu.device.createTexture(o);return this._gpuSources[e.uid]=n,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),n}onSourceUpdate(e){let t=this.getGpuSource(e);t&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,t,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e))}onSourceUnload(e){let t=this._gpuSources[e.uid];t&&(this._gpuSources[e.uid]=null,t.destroy())}onUpdateMipmaps(e){this._mipmapGenerator||(this._mipmapGenerator=new p.GpuMipmapGenerator(this._gpu.device));let t=this.getGpuSource(e);this._mipmapGenerator.generateMipmap(t)}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){let t=this._gpuSources[e.uid];t?(t.width!==e.pixelWidth||t.height!==e.pixelHeight)&&(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e)):this.initSource(e)}_initSampler(e){return this._gpuSamplers[e._resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e._resourceId]}getGpuSampler(e){return this._gpuSamplers[e._resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){return this._bindGroupHash[e.uid]??this._createTextureBindGroup(e)}_createTextureBindGroup(e){let t=e.source;return this._bindGroupHash[e.uid]=new u.BindGroup({0:t,1:t.style,2:new n.UniformGroup({uTextureMatrix:{type:"mat3x3<f32>",value:e.textureMatrix.mapCoord}})}),this._bindGroupHash[e.uid]}getTextureView(e){let t=e.source;return this._textureViewHash[t.uid]??this._createTextureView(t)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){let t=this._renderer,r=t.gpu.device.createCommandEncoder(),i=(0,s.DOMAdapter).get().createCanvas();i.width=e.source.pixelWidth,i.height=e.source.pixelHeight;let o=i.getContext("webgpu");return o.configure({device:t.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:(0,s.DOMAdapter).get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),r.copyTextureToTexture({texture:t.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:o.getCurrentTexture()},{width:i.width,height:i.height}),t.gpu.device.queue.submit([r.finish()]),i}getPixels(e){let t=this.generateCanvas(e),r=(0,a.CanvasPool).getOptimalCanvasAndContext(t.width,t.height),i=r.context;i.drawImage(t,0,0);let{width:s,height:o}=t,n=new Uint8ClampedArray(i.getImageData(0,0,s,o).data.buffer);return(0,a.CanvasPool).returnCanvasAndContext(r),{pixels:n,width:s,height:o}}destroy(){for(let e of(this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null,Object.keys(this._bindGroupHash))){let t=Number(e),r=this._bindGroupHash[t];r?.destroy(),this._bindGroupHash[t]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}f.extension={type:[o.ExtensionType.WebGPUSystem],name:"texture"}}),r("f2X4l",function(t,r){e(t.exports,"gpuUploadBufferImageResource",()=>i);let i={type:"image",upload(e,t,r){let i=e.resource,s=(0|e.pixelWidth)*(0|e.pixelHeight),o=i.byteLength/s;r.device.queue.writeTexture({texture:t},i,{offset:0,rowsPerImage:e.pixelHeight,bytesPerRow:e.pixelHeight*o},{width:e.pixelWidth,height:e.pixelHeight,depthOrArrayLayers:1})}}}),r("BIhHc",function(t,r){e(t.exports,"blockDataMap",()=>i),e(t.exports,"gpuUploadCompressedTextureResource",()=>o);let i={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},s={blockBytes:4,blockWidth:1,blockHeight:1},o={type:"compressed",upload(e,t,r){let o=e.pixelWidth,n=e.pixelHeight,a=i[e.format]||s;for(let i=0;i<e.resource.length;i++){let s=e.resource[i],u=Math.ceil(o/a.blockWidth)*a.blockBytes;r.device.queue.writeTexture({texture:t,mipLevel:i},s,{offset:0,bytesPerRow:u},{width:Math.ceil(o/a.blockWidth)*a.blockWidth,height:Math.ceil(n/a.blockHeight)*a.blockHeight,depthOrArrayLayers:1}),o=Math.max(o>>1,1),n=Math.max(n>>1,1)}}}}),r("fK0Rx",function(t,r){e(t.exports,"gpuUploadImageResource",()=>i);let i={type:"image",upload(e,t,r){let i=e.resource;if(!i)return;let s=Math.min(t.width,e.resourceWidth||e.pixelWidth),o=Math.min(t.height,e.resourceHeight||e.pixelHeight),n="premultiply-alpha-on-upload"===e.alphaMode;r.device.queue.copyExternalImageToTexture({source:i},{texture:t,premultipliedAlpha:n},{width:s,height:o})}}}),r("jGr2y",function(r,i){e(r.exports,"gpuUploadVideoResource",()=>o);var s=t("fK0Rx");let o={type:"video",upload(e,t,r){(0,s.gpuUploadImageResource).upload(e,t,r)}}}),r("h3MwH",function(t,r){e(t.exports,"GpuMipmapGenerator",()=>i);class i{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let t=this.pipelines[e];return t||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),t=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=t),t}generateMipmap(e){let t=this._getMipmapPipeline(e.format);if("3d"===e.dimension||"1d"===e.dimension)throw Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=e,i=e.depthOrArrayLayers||1,s=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){let t={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};r=this.device.createTexture(t)}let o=this.device.createCommandEncoder({}),n=t.getBindGroupLayout(0);for(let a=0;a<i;++a){let i=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),u=s?1:0;for(let s=1;s<e.mipLevelCount;++s){let e=r.createView({baseMipLevel:u++,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),s=o.beginRenderPass({colorAttachments:[{view:e,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),l=this.device.createBindGroup({layout:n,entries:[{binding:0,resource:this.sampler},{binding:1,resource:i}]});s.setPipeline(t),s.setBindGroup(0,l),s.draw(3,1,0,0),s.end(),i=e}}if(!s){let t={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i};for(let i=1;i<e.mipLevelCount;++i)o.copyTextureToTexture({texture:r,mipLevel:i-1},{texture:e,mipLevel:i},t),t.width=Math.ceil(t.width/2),t.height=Math.ceil(t.height/2)}return this.device.queue.submit([o.finish()]),s||r.destroy(),e}}}),r("6B0gZ",function(t,r){e(t.exports,"color32BitToUniform",()=>i);function i(e,t,r){let i=(e>>24&255)/255;t[r++]=(255&e)/255*i,t[r++]=(e>>8&255)/255*i,t[r++]=(e>>16&255)/255*i,t[r++]=i}}),r("6qNFd",function(t,r){e(t.exports,"BatchableSprite",()=>i);class i{constructor(){this.batcherName="default",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}}),r("3Xbp7",function(r,i){e(r.exports,"TexturePool",()=>u);var s=t("NbSCN"),o=t("iA5fe"),n=t("bLlTJ");let a=0,u=new class{constructor(e){this._poolKeyHash=/* @__PURE__ */Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,t,r){let i=new o.TextureSource({...this.textureOptions,width:e,height:t,resolution:1,antialias:r,autoGarbageCollect:!0});return new n.Texture({source:i,label:`texturePool_${a++}`})}getOptimalTexture(e,t,r=1,i){let o=Math.ceil(e*r-1e-6),n=Math.ceil(t*r-1e-6),a=((o=(0,s.nextPow2)(o))<<17)+((n=(0,s.nextPow2)(n))<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let u=this._texturePool[a].pop();return u||(u=this.createTexture(o,n,i)),u.source._resolution=r,u.source.width=o/r,u.source.height=n/r,u.source.pixelWidth=o,u.source.pixelHeight=n,u.frame.x=0,u.frame.y=0,u.frame.width=e,u.frame.height=t,u.updateUvs(),this._poolKeyHash[u.uid]=a,u}getSameSizeTexture(e,t=!1){let r=e.source;return this.getOptimalTexture(e.width,e.height,r._resolution,t)}returnTexture(e){let t=this._poolKeyHash[e.uid];this._texturePool[t].push(e)}clear(e){if(e=!1!==e)for(let e in this._texturePool){let t=this._texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this._texturePool={}}}});
//# sourceMappingURL=WebGPURenderer.fec95d86.js.map
